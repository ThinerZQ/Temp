<html>
<head>
  <title>IP协议</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272632; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="895"/>
<h1>IP协议</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">协议是</span><span style="FONT-SIZE: 9pt">TCP/IP</span><span style="FONT-SIZE: 9pt">协议簇中的核心协议，也是</span><span style="FONT-SIZE: 9pt">TCP/IP</span><span style="FONT-SIZE: 9pt">的载体。所有的</span><span style="FONT-SIZE: 9pt">TCP</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">UDP</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">及</span><span style="FONT-SIZE: 9pt">IGMP</span><span style="FONT-SIZE: 9pt">数据都以</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">数据报格式传输。</span><span style="FONT-SIZE: 9pt"><br/>
IP</span><span style="FONT-SIZE: 9pt">提供<span style="COLOR: red">不可靠</span>的，<span style="COLOR: red">无连接</span>的数据传送服务。</span><span style="FONT-SIZE: 9pt"><br/></span><span style="FONT-SIZE: 9pt">不可靠指它不能保证</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">数据报能成功到达目的地。</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">仅提供最好的传输服务。当发生某种错误时，如某个路由器暂时用完了缓冲区，</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">有一个简单的错误处理算法：丢弃该数据报，然后发送</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">消息给信源。任何要求的可靠性必须由上层来提供。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">无连接指</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">并不维护任何关于后续数据报的状态信息。每个数据报的处理是相互独立的。</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">数据报可以不按发送顺序接收。如果一信源向相同的信宿发送两个连续的数据报（先是</span><span style="FONT-SIZE: 9pt">A</span><span style="FONT-SIZE: 9pt">，然后是</span><span style="FONT-SIZE: 9pt">B</span><span style="FONT-SIZE: 9pt">）每个数据报都是独立的进行路由选择，可能选择不同的路线，因此</span><span style="FONT-SIZE: 9pt">B</span><span style="FONT-SIZE: 9pt">可能在</span><span style="FONT-SIZE: 9pt">A</span><span style="FONT-SIZE: 9pt">到达之前先到达。</span> </div><div align="left" style="BACKGROUND: white"> </div><div align="left" style="BACKGROUND: white"> <strong><span style="FONT-SIZE: 12pt">IP</span></strong><strong><span style="FONT-SIZE: 12pt">包头</span></strong></div><div align="left" style="BACKGROUND: white"><strong><span style="FONT-SIZE: 9pt"><img src="IP协议_files/Image.jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></strong></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">版本号</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">4</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">，用来标识</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">版本号。这个</span><span style="FONT-SIZE: 9pt">4</span><span style="FONT-SIZE: 9pt">位字段的值设置为二进制的</span><span style="FONT-SIZE: 9pt">0100</span><span style="FONT-SIZE: 9pt">表示</span><span style="FONT-SIZE: 9pt">IPv4</span><span style="FONT-SIZE: 9pt">，设置为</span><span style="FONT-SIZE: 9pt">0110</span><span style="FONT-SIZE: 9pt">表示</span><span style="FONT-SIZE: 9pt">IPv6</span><span style="FONT-SIZE: 9pt">。目前使用的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">协议版本号是</span><span style="FONT-SIZE: 9pt">4</span><span style="FONT-SIZE: 9pt">。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">首部长度</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">4</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。标识包括选项在内的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">头部字段的长度。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">服务类型</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">8</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。服务类型字段被划分成两个子字段：</span><span style="FONT-SIZE: 9pt">3bit</span><span style="FONT-SIZE: 9pt">的优先级字段和</span><span style="FONT-SIZE: 9pt">4bit TOS</span><span style="FONT-SIZE: 9pt">字段，最后一位置为</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">。</span><span style="FONT-SIZE: 9pt">4bit</span><span style="FONT-SIZE: 9pt">的</span><span style="FONT-SIZE: 9pt">TOS</span><span style="FONT-SIZE: 9pt">分别代表：最小时延，最大吞吐量，最高可靠性和最小花费。</span><span style="FONT-SIZE: 9pt">4bit</span><span style="FONT-SIZE: 9pt">中只能将其中一个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">位置</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">。如果</span><span style="FONT-SIZE: 9pt">4</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">均为</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">，则代表一般服务。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt"><img src="IP协议_files/Image [1].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></div><div align="left" style="BACKGROUND: white"> </div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 10pt"><img src="IP协议_files/Image [2].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">现在大多数的</span><span style="FONT-SIZE: 9pt">TCP/IP</span><span style="FONT-SIZE: 9pt">实现都不支持</span><span style="FONT-SIZE: 9pt">TOS</span><span style="FONT-SIZE: 9pt">特性，但自</span><span style="FONT-SIZE: 9pt">4.3BSD Reno</span><span style="FONT-SIZE: 9pt">以后的新版系统都对它进行了设置。另外，</span><span style="FONT-SIZE: 9pt">OSPF</span><span style="FONT-SIZE: 9pt">和</span><span style="FONT-SIZE: 9pt">IS-IS</span><span style="FONT-SIZE: 9pt">都可以根据这些字段的值进行路由策略。而类似</span><span style="FONT-SIZE: 9pt">SLIP</span><span style="FONT-SIZE: 9pt">这样的协议虽然提供基于服务类型的排队方法，允许对交互型数据优先进行处理，但它的这种排队机制由</span><span style="FONT-SIZE: 9pt">SLIP</span><span style="FONT-SIZE: 9pt">自身来判断和处理。驱动程序会先查看协议字段（确定是否是</span><span style="FONT-SIZE: 9pt">TCP</span><span style="FONT-SIZE: 9pt">段），然后检查</span><span style="FONT-SIZE: 9pt">TCP</span><span style="FONT-SIZE: 9pt">信源和信宿的端口号来判断是否是一个交互服务。</span></div><div align="left" style="BACKGROUND: white"> </div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">最近，</span><span style="FONT-SIZE: 9pt">TOS</span><span style="FONT-SIZE: 9pt">字段已经作为区分服务（</span><span style="FONT-SIZE: 9pt">Diffserv</span><span style="FONT-SIZE: 9pt">）架构的一部分被重新定义了。</span><span style="FONT-SIZE: 9pt">Diffserv</span><span style="FONT-SIZE: 9pt">比</span><span style="FONT-SIZE: 9pt">TOS</span><span style="FONT-SIZE: 9pt">定义所允许的处理更加灵活。在</span><span style="FONT-SIZE: 9pt">Diffserv</span><span style="FONT-SIZE: 9pt">下，能够在一台路由器上定义服务分类（</span><span style="FONT-SIZE: 9pt">COS</span><span style="FONT-SIZE: 9pt">），将数据包归类到这些分类中去。路由器可以根据它们的分类使用不同的优先级对数据包进行转发。每一个排序和转发处理称为一个</span><span style="FONT-SIZE: 9pt">PHB</span><span style="FONT-SIZE: 9pt">。这个架构也被简称为</span><span style="FONT-SIZE: 9pt">COS</span><span style="FONT-SIZE: 9pt">。</span></div><div align="left" style="BACKGROUND: white; TEXT-INDENT: 21.75pt"><span style="FONT-SIZE: 9pt"><img src="IP协议_files/Image [3].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></div><div align="left" style="BACKGROUND: white; TEXT-INDENT: 21.75pt"> </div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">利用开始的</span><span style="FONT-SIZE: 9pt">6</span><span style="FONT-SIZE: 9pt">个位构成</span><span style="FONT-SIZE: 9pt">DSCP</span><span style="FONT-SIZE: 9pt">位，可以使用任意数值或根据区分服务体系结构中预先定义的服务类别，最多可以定义</span><span style="FONT-SIZE: 9pt">64</span><span style="FONT-SIZE: 9pt">个不同的服务类别并整理到</span><span style="FONT-SIZE: 9pt">PHB</span><span style="FONT-SIZE: 9pt">中。</span><span style="FONT-SIZE: 9pt">ECN</span><span style="FONT-SIZE: 9pt">为显式拥塞通知位。当路由器支持该特性时，这些位可以用于拥塞信号（</span><span style="FONT-SIZE: 9pt">ECN=11</span><span style="FONT-SIZE: 9pt">）。</span></div><div align="left" style="BACKGROUND: white; TEXT-INDENT: 21.75pt"> </div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">总长度字段</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">16</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。接收者用</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">数据报总长度减去</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">报头长度就可以确定数据包数据有效负荷的大小。</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">数据报最长可达</span><span style="FONT-SIZE: 9pt">65535</span><span style="FONT-SIZE: 9pt">字节。</span></div><div align="left" style="BACKGROUND: white"> </div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">标识字段</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">16</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。唯一的标识主机发送的每一份数据报。接收方根据分片中的标识字段是否相同来判断这些分片是否是同一个数据报的分片，从而进行分片的重组。通常每发送一份报文它的值就会加</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">标志字段</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">3</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。用于标识数据报是否分片。第</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">位没有使用，第</span><span style="FONT-SIZE: 9pt">2</span><span style="FONT-SIZE: 9pt">位是不分段（</span><span style="FONT-SIZE: 9pt">DF</span><span style="FONT-SIZE: 9pt">）位。当</span><span style="FONT-SIZE: 9pt">DF</span><span style="FONT-SIZE: 9pt">位被设置为</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">时，表示路由器不能对数据包进行分段处理。如果数据包由于不能分段而未能被转发，那么路由器将丢弃该数据包并向源发送</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">不可达。第</span><span style="FONT-SIZE: 9pt">3</span><span style="FONT-SIZE: 9pt">位是分段（</span><span style="FONT-SIZE: 9pt">MF</span><span style="FONT-SIZE: 9pt">）位。当路由器对数据包进行分段时，除了最后一个分段的</span><span style="FONT-SIZE: 9pt">MF</span><span style="FONT-SIZE: 9pt">位被设置为</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">外，其他的分段的</span><span style="FONT-SIZE: 9pt">MF</span><span style="FONT-SIZE: 9pt">位均设置为</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">，以便接收者直到收到</span><span style="FONT-SIZE: 9pt">MF</span><span style="FONT-SIZE: 9pt">位为</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">的分片为止。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">位偏移</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">13</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。在接收方进行数据报重组时用来标识分片的顺序。用于指明分段起始点相对于报头起始点的偏移量。由于分段到达时可能错序，所以位偏移字段可以使接收者按照正确的顺序重组数据包。</span></div><div align="left" style="BACKGROUND: white"><u><span style="FONT-SIZE: 9pt">当数据包的长度超过它所要去的那个数据链路的</span></u><u><span style="FONT-SIZE: 9pt">MTU</span></u><u><span style="FONT-SIZE: 9pt">时，路由器要将它分片。数据包中的数据将被分成小片，每一片被封装在独立的数据包中。接收端使用标识符，分段偏移以及标记域的</span></u><u><span style="FONT-SIZE: 9pt">MF</span></u><u><span style="FONT-SIZE: 9pt">位来进行重组。</span></u></div><div align="left" style="BACKGROUND: white"><strong> </strong></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">生存时间</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">8</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。</span><span style="FONT-SIZE: 9pt">TTL</span><span style="FONT-SIZE: 9pt">域防止丢失的数据包在无休止的传播。该域包含一个</span><span style="FONT-SIZE: 9pt">8</span><span style="FONT-SIZE: 9pt">位整数，此数由产生数据包的主机设定。</span><span style="FONT-SIZE: 9pt">TTL</span><span style="FONT-SIZE: 9pt">值设置了数据报可以经过的最多的路由器数。</span><span style="FONT-SIZE: 9pt">TTL</span><span style="FONT-SIZE: 9pt">的初始值由源主机设置（通常为</span><span style="FONT-SIZE: 9pt">32</span><span style="FONT-SIZE: 9pt">或</span><span style="FONT-SIZE: 9pt">64</span><span style="FONT-SIZE: 9pt">），每经过一个处理它的路由器，</span><span style="FONT-SIZE: 9pt">TTL</span><span style="FONT-SIZE: 9pt">值减</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">。如果一台路由器将</span><span style="FONT-SIZE: 9pt">TTL</span><span style="FONT-SIZE: 9pt">减至</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">，它将丢弃该数据包并发送一个</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">超时消息给数据包的源地址。<u>注意：</u></span><u><span style="FONT-SIZE: 9pt">TTL</span></u><u><span style="FONT-SIZE: 9pt">值经过</span></u><u><span style="FONT-SIZE: 9pt">PIX</span></u><u><span style="FONT-SIZE: 9pt">时不减</span></u><u><span style="FONT-SIZE: 9pt">1</span></u><u><span style="FONT-SIZE: 9pt">。</span></u></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">协议字段</span><span style="FONT-SIZE: 9pt">：</span><span style="FONT-SIZE: 9pt">8</span><span style="FONT-SIZE: 9pt">个</span><span style="FONT-SIZE: 9pt">bit</span><span style="FONT-SIZE: 9pt">。用来标识是哪个协议向</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">传送数据。</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">为</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">IGMP</span><span style="FONT-SIZE: 9pt">为</span><span style="FONT-SIZE: 9pt">2</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">TCP</span><span style="FONT-SIZE: 9pt">为</span><span style="FONT-SIZE: 9pt">6</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">UDP</span><span style="FONT-SIZE: 9pt">为</span><span style="FONT-SIZE: 9pt">17</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">GRE</span><span style="FONT-SIZE: 9pt">为</span><span style="FONT-SIZE: 9pt">47</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">ESP</span><span style="FONT-SIZE: 9pt">为</span><span style="FONT-SIZE: 9pt">50</span><span style="FONT-SIZE: 9pt">。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">首部校验和</span><span style="FONT-SIZE: 9pt">：根据</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">首部计算的校验和码。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt; COLOR: red">Option</span><span style="FONT-SIZE: 9pt; COLOR: red">选项</span><span style="FONT-SIZE: 9pt">：是数据报中的一个可变长的可选信息。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 10pt"><img src="IP协议_files/Image [4].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">选项字段以</span><span style="FONT-SIZE: 9pt">32bit</span><span style="FONT-SIZE: 9pt">为界，不足时插入值为</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">的填充字节。保证</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">首部始终是</span><span style="FONT-SIZE: 9pt">32bit</span><span style="FONT-SIZE: 9pt">的整数倍。</span></div><div align="left" style="BACKGROUND: white"> </div><div align="left" style="BACKGROUND: white"><strong><span style="FONT-SIZE: 12pt">IP</span></strong><strong><span style="FONT-SIZE: 12pt">路由选择</span></strong></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">如果目的主机与源主机直接相连（点对点）或都在一个共享网络上（以太网），那么</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">数据报就直接送达到目的主机上。否则，主机把数据报发到网关（路由器），由路由器来转发该数据报。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">可以从</span><span style="FONT-SIZE: 9pt">TCP</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">UDP</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">IGMP</span><span style="FONT-SIZE: 9pt">接收数据报并进行发送，或者从一个接口接收数据报并进行发送。</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">层在内存中有一个路由表，当收到一份数据报并进行发送时，都要对该表进行搜索。当数据报来自某个接口时，</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">首先检查目的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址是否为本机的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址或广播地址。如果是，数据报就被送到由</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">首部协议字段所指定的协议模块进行处理。如果数据报的目的不是这些地址，那么：</span><span style="FONT-SIZE: 9pt">⑴</span><span style="FONT-SIZE: 9pt">如果</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">层被设置成路由器的功能，那么就对数据报进行转发。</span><span style="FONT-SIZE: 9pt">⑵</span><span style="FONT-SIZE: 9pt">数据报被丢弃。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">路由表：</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">目的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址：可以是一个完整的主机地址，也可以是一个网络地址。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">下一跳地址：一个直接相连网络上的路由器。下一跳路由器不一定是最终目的地，但它可以把传送给它的数据报转发到目的。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">标志：其中一个标志指明目的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址是网络地址还是主机地址，另一个标志指明下一站路由器是否为真正的下一跳路由器还是一个直连接口。</span></div><div align="left" style="BACKGROUND: white"><u><span style="FONT-SIZE: 9pt">IP</span></u><u><span style="FONT-SIZE: 9pt">路由选择是逐跳的进行的。</span></u><u><span style="FONT-SIZE: 9pt">IP</span></u><u><span style="FONT-SIZE: 9pt">并不知道到达任何目的的完整路径。所有的</span></u><u><span style="FONT-SIZE: 9pt">IP</span></u><u><span style="FONT-SIZE: 9pt">路由选择只为数据报传送提供下一站路由器的</span></u><u><span style="FONT-SIZE: 9pt">IP</span></u><u><span style="FONT-SIZE: 9pt">地址。它假定下一站路由器比发送数据报的主机更接近目的，并且下一站路由器与该主机是直接相连的。</span></u></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">路由选择主要完成以下功能：</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">⑴</span><span style="FONT-SIZE: 9pt">搜索路由表，寻找与目的</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址完全匹配的条目。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">⑵</span><span style="FONT-SIZE: 9pt">如果</span><span style="FONT-SIZE: 9pt">⑴</span><span style="FONT-SIZE: 9pt">失败，则寻找与目的网络号匹配的条目。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">⑶</span><span style="FONT-SIZE: 9pt">如果</span><span style="FONT-SIZE: 9pt">⑴</span><span style="FONT-SIZE: 9pt">和</span><span style="FONT-SIZE: 9pt">⑵</span><span style="FONT-SIZE: 9pt">都失败，则寻找默认路路由。如果找到，则把报文发送给该条目指定的下一站路由器。如果未找到，则丢弃数据报并向源发送</span><span style="FONT-SIZE: 9pt">ICMP</span><span style="FONT-SIZE: 9pt">不可达。</span></div><div align="left" style="BACKGROUND: white"> </div><div align="left" style="BACKGROUND: white"><strong><span style="FONT-SIZE: 12pt">子网寻址与子网掩码</span></strong></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址的分类如下：</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt"><img src="IP协议_files/Image [5].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址掩码标识了</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址的网络部分。</span><span style="FONT-SIZE: 9pt">32</span><span style="FONT-SIZE: 9pt">位掩码中的</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">标识了</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址中相应的网络位，</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">标识了主机位。将</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址和掩码进行与运算，结果是</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址中对应于掩码网络部分的那一段不变，而对应于主机部分的全变成</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">子网化是对</span><span style="FONT-SIZE: 9pt">A</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">B</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">C</span><span style="FONT-SIZE: 9pt">类地址进行子分组。如果没有子网化，</span><span style="FONT-SIZE: 9pt">A</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">B</span><span style="FONT-SIZE: 9pt">，</span><span style="FONT-SIZE: 9pt">C</span><span style="FONT-SIZE: 9pt">类的主</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址的网络部分将只能标识一个数据链路。子网化使用主</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址中的一些主机位作为网络位，允许一个单独的主地址被划分为多个网络地址。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">有类的路由协议不能区分全</span><span style="FONT-SIZE: 9pt">0</span><span style="FONT-SIZE: 9pt">和主</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址，也不能区分全</span><span style="FONT-SIZE: 9pt">1</span><span style="FONT-SIZE: 9pt">子网和主</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址的全主机，全子网广播地址</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">此部分为最基础知识，不再赘述。</span></div><div align="left" style="BACKGROUND: white"><strong> </strong></div><div align="left" style="BACKGROUND: white"><strong><span style="FONT-SIZE: 12pt">特殊的</span></strong><strong><span style="FONT-SIZE: 12pt">IP</span></strong><strong><span style="FONT-SIZE: 12pt">地址</span></strong></div><div align="left" style="BACKGROUND: white"><strong><span style="FONT-SIZE: 9pt"><img src="IP协议_files/Image [6].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></strong></div><div align="left" style="BACKGROUND: white"><strong> </strong></div><div align="left" style="BACKGROUND: white"><strong><span style="FONT-SIZE: 12pt">Ifconfig &amp; Netstat</span></strong> <strong><span style="FONT-SIZE: 12pt">命令</span></strong></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">Ifconfig</span><span style="FONT-SIZE: 9pt">命令一般在引导时运行，以配置主机上的每个接口。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">netstat</span><span style="FONT-SIZE: 9pt">命令也提供系统上的接口信息。</span><span style="FONT-SIZE: 9pt">-i</span><span style="FONT-SIZE: 9pt">参数将打印出接口信息，</span><span style="FONT-SIZE: 9pt">-n</span><span style="FONT-SIZE: 9pt">参数则打印出</span><span style="FONT-SIZE: 9pt">IP</span><span style="FONT-SIZE: 9pt">地址，而不是主机名字。</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt">NETSTAT [-a] [-b] [-e] [-n] [-o] [-p proto] [-r] [-s] [-v] [interval]</span></div><div align="left" style="BACKGROUND: white"><span style="FONT-SIZE: 9pt"><img src="IP协议_files/Image [7].jpg" type="image/jpeg" style="cursor: default;cursor: default;"/></span></div></div>
</div></body></html> 